<!DOCTYPE html>
<html lang="zh_cn">
<head>
    <meta charset="UTF-8">
    <title>Monkey</title>
    <style type="text/css">
        #input {
            margin: 20px;
            width:80%;
        }
        .row {
            margin: 10px;
        }

    </style>
    <script type="text/javascript" src="./qwebchannel.js"></script>
    <script src="https://img.highcharts.com.cn/highcharts/highcharts.js"></script>
    <script src="https://img.highcharts.com.cn/highcharts/modules/exporting.js"></script>
    <script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
    <script>
    var back = "";
    var getCpu = [];
    var it = 0;
    var cpu = "";
    var acpu = [];
    window.onload = function(){
        <!--drawCpu(cpu, acpu);-->
        new QWebChannel(qt.webChannelTransport, function(channel){
            window.share = channel.objects.share;
        });
    };
    function WebToQt() {
        var name = document.getElementById("username").value;
        window.share.WebToQt(name);
    }
    function QtToWeb(){
        window.share.QtToWeb(function(res){
            back = res;
            return res;
        });
        setTimeout(update, 1000);
    }
    function update(){
        document.getElementById("back").value = back;
    }
    function run(){
        var pkg = " -p " + document.getElementById("package").value
        var sed = " -s " + document.getElementById("seed").value
        var t = " --throttle " + document.getElementById("throttle").value
        var v = " " + document.getElementById("v").value
        var touch = " --pct-touch " + document.getElementById("touch").value
        var syskeys = " --pct-syskeys " + document.getElementById("syskeys").value
        var appswitch = " --pct-appswitch " + document.getElementById("appswitch").value
        var times = " " + document.getElementById("times").value
        var tmp = pkg + sed + t + v + times
        window.share.Run(tmp);
    }



    </script>
</head>
<body>
<div id="input">
    <div class="row">
        <span>包名: <input type="text" id="package" value="com.miui.calculator"></span>
        <span>seed: <input type="text" id="seed" value="23"></span>
    </div>
    <div class="row">
        <span>延迟: <input type="text" id="throttle" value="150"></span>
        <span>日志: <input type="text" id="v" value="-v -v -v"></span>
    </div>
    <div class="row">
        <span>--pct-touch: <input type="text" id="touch" value="30"></span>
        <span>--pct-syskeys: <input type="text" id="syskeys" value="0"></span>

    </div>
    <div class="row">
        <span>--pct-appswitch: <input type="text" id="appswitch" value="0"></span>
        <span>次数: <input type="text" id="times" value="1000"></span>

    </div>
    <div class="row">
        <button onclick="run();">运行</button>
        <button onclick="monitor();">监控</button>
        <button onclick="stopIt();">停止监控</button>
    </div>
</div>


<div id="container" style="min-width:600px;height:400px"></div>
<script type="text/javascript">
    Highcharts.setOptions({
		global: {
				useUTC: false
		}
    });

    var chart = Highcharts.chart('container', {
		chart: {
				type: 'spline',
				marginRight: 10,
		},
		title: {
				text: 'CPU Trend'
		},
		xAxis: {
				type: 'datetime',
				tickPixelInterval: 150
		},
		yAxis: {
				title: {
						text: null
				}
		},
		tooltip: {
				formatter: function () {
						return '<b>' + this.series.name + '</b><br/>' +
								Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
								Highcharts.numberFormat(this.y, 2);
				}
		},
		legend: {
				enabled: false
		},
		series: [{
				name: 'CPU',
				data: [0]
		}]
    });

        function GetCpu(){
        var cc = "";
        window.share.Cpu(function(res){
            cc = res;
            updateCpu(cc);
        });
    }


    function stopIt(){
        setTimeout(function(){clearInterval(it);}, 1000);
    }

    function monitor(){
        it = setInterval(function(){GetCpu()}, 5000);
        <!--setTimeout(stopIt, 20000);-->
    }

    function updateCpu(cc){
        cpu.push(parseInt(cc));
        alert(cpu);
        charts.series[0].update({data:cc});
    }
</script>
</body>
</html>